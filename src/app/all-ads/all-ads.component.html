<app-header></app-header>
<main class="main">
  <div class="page-header breadcrumb-wrap">
    <div class="container">
      <div class="breadcrumb">
        <a href="/" rel="nofollow"><i class="fi-rs-home mr-5"></i>Accueil</a>
        <span></span> Annonces <span></span> Filtrer
      </div>
    </div>
  </div>
  <div class="container mb-30 mt-30">
    <div class="row">
      <div class="col-lg-12">
        <a class="shop-filter-toogle">
          <span class="fi-rs-filter mr-5"></span>
          Filtres
          <i class="fi-rs-angle-small-down angle-down"></i>
          <i class="fi-rs-angle-small-up angle-up"></i>
        </a>
        <div class="shop-product-fillter-header">
          <div class="row">
            <div class="col-xl-3 col-lg-6 col-md-6 mb-lg-0 mb-md-5 mb-sm-5">
              <div class="card">
                <h5 class="mb-10">Rechercher :</h5>
                <div class="sidebar-widget price_range range">
                  <div class="price-filter mb-20">
                    <div class="price-filter-inner">
                      <div class="d-flex justify-content-between">
                        <input
                          type="text"
                          placeholder="Rechercher par titre"
                          [(ngModel)]="searchTitle"
                          (input)="filterAdsByTitle($event)"
                          class="form-control"
                          style="width: 100%"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="col-xl-3 col-lg-6 col-md-6 mb-lg-0 mb-md-2 mb-sm-2"
              *ngFor="let key of getFilterKeys()"
            >
              <div class="card">
                <h5 class="mb-30">{{ filters[key].label }} :</h5>
                <div class="select-menu" *ngIf="filters[key].conditions">
                  <div
                    class="select-btn"
                    style="
                      background: #fff;
                      border: 1px solid #ececec;
                      box-shadow: none;
                      padding-left: 20px;
                      font-size: 16px;
                      width: 100%;
                    "
                    (click)="toggleOptioned(key)"
                  >
                    <span class="sBtn-text">
                      <div style="display: flex; align-items: center">
                        <p style="margin: 0">
                          {{
                            filters[key].selectedCondition?.value ||
                              "Choisissez un filtre"
                          }}
                        </p>
                      </div>
                    </span>
                    <i class="bx bx-chevron-down"></i>
                  </div>
                  <ul
                    class="options options-container"
                    [ngClass]="{ active: optionsVisibleMap[key] }"
                    (click)="stopEventPropagation($event)"
                    style="font-size: smaller"
                  >
                    <li
                      class="option"
                      *ngFor="
                        let condition of getConditionsArray(
                          filters[key].conditions!
                        )
                      "
                      (click)="selectOptioneds(key, condition)"
                    >
                      <span class="d-inline-flex align-items-center">
                        {{ condition.value }}
                      </span>
                    </li>
                  </ul>
                </div>
                <div class="select-menu" *ngIf="filters[key].options">
                  <div
                    class="select-btn"
                    style="
                      background: #fff;
                      border: 1px solid #ececec;
                      box-shadow: none;
                      padding-left: 20px;
                      font-size: 16px;
                      width: 100%;
                    "
                    (click)="toggleOptioned(key)"
                  >
                    <span class="sBtn-text">
                      <div style="display: flex; align-items: center">
                        <p style="margin: 0">
                          {{
                            filters[key].selectedCondition?.value ||
                              "Choisissez une option"
                          }}
                        </p>
                      </div>
                    </span>
                    <i class="bx bx-chevron-down"></i>
                  </div>
                  <ul
                    class="options options-container"
                    [ngClass]="{ active: optionsVisibleMap[key] }"
                    (click)="stopEventPropagation($event)"
                    style="font-size: smaller"
                  >
                    <li
                      class="option"
                      *ngFor="let optionKey of getOptionKeys(key)"
                      (click)="
                        selectOptioneds(key, {
                          key: optionKey,
                          value: getOptionValues(key, optionKey)
                        })
                      "
                    >
                      <span class="d-inline-flex align-items-center">
                        {{ getOptionValues(key, optionKey) }}
                      </span>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="col-xl-3 col-lg-6 col-md-6 mb-lg-0 mb-md-2 mb-sm-2">
              <div class="card">
                <h5 class="mb-30">Sélection par Catégorie :</h5>
                <div class="select-menu">
                  <div
                    class="select-btn"
                    style="
                      background: #fff;
                      border: 1px solid #ececec;
                      box-shadow: none;
                      padding-left: 20px;
                      font-size: 16px;
                      width: 100%;
                    "
                    (click)="toggleOptions($event)"
                  >
                    <span class="sBtn-text">
                      <div style="display: flex; align-items: center">
                        <img
                          src="{{ selectedOption?.media?.url }}"
                          *ngIf="selectedOption?.name"
                          alt=""
                          class="iconUrl"
                          style="max-width: 35px; margin-right: 1rem"
                        />
                        <p style="margin: 0">
                          {{
                            selectedOption?.name || "Choisissez une catégorie"
                          }}
                        </p>
                      </div>
                    </span>
                    <i class="bx bx-chevron-down"></i>
                  </div>
                  <ul
                    class="options options-container"
                    [ngClass]="{
                      active: optionsVisible
                    }"
                    (click)="stopEventPropagation($event)"
                    style="font-size: smaller"
                  >
                    <li
                      class="option"
                      *ngFor="let category of categories"
                      (click)="selectOption(category)"
                    >
                      <span class="d-inline-flex align-items-center">
                        <img
                          src="{{ category.media?.url }}"
                          alt=""
                          class="iconUrl"
                          style="max-width: 35px; margin-right: 1rem"
                        />
                        {{ category.name }}
                      </span>
                    </li>
                  </ul>
                </div>

                <div
                  class="select-menu"
                  *ngIf="subcategories.length > 0"
                  style="margin-top: 1rem"
                >
                  <div
                    class="select-btn"
                    style="
                      background: #fff;
                      border: 1px solid #ececec;
                      height: 64px;
                      box-shadow: none;
                      padding-left: 20px;
                      font-size: 16px;
                      width: 100%;
                    "
                    (click)="toggleSubOptions($event)"
                  >
                    <span class="sBtn-text">
                      <div style="display: flex; align-items: center">
                        <img
                          src="{{ selectedOption?.media?.url }}"
                          *ngIf="selectedSubOption?.name"
                          alt=""
                          class="iconUrl"
                          style="max-width: 35px; margin-right: 1rem"
                        />
                        <p style="margin: 0">
                          {{ selectedSubOption?.name || "Select Subcategory" }}
                        </p>
                      </div>
                    </span>
                    <i class="bx bx-chevron-down"></i>
                  </div>
                  <ul
                    class="options options-container"
                    [ngClass]="{
                      active: subOptionsVisible
                    }"
                    (click)="stopEventPropagation($event)"
                    style="font-size: smaller"
                  >
                    <li
                      class="option"
                      *ngFor="let subcategory of subcategories"
                      (click)="selectSubOption(subcategory)"
                    >
                      <span class="d-inline-flex align-items-center">
                        <img
                          src="{{ selectedOption?.media?.url }}"
                          alt=""
                          class="iconUrl"
                          style="max-width: 35px; margin-right: 1rem"
                        />
                        {{ subcategory.name }}
                      </span>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 mb-lg-0 mb-md-5 mb-sm-5">
              <div class="card">
                <h5 class="mb-10">Sélection par prix :</h5>
                <div class="sidebar-widget price_range range">
                  <div class="price-filter mb-20">
                    <div class="price-filter-inner">
                      <div class="d-flex justify-content-between">
                        <div class="caption">
                          De :
                          <input
                            type="number"
                            [(ngModel)]="minPrice"
                            (input)="filterAdsByPrice()"
                            class="form-control"
                            style="width: 85%; display: inline-block"
                          />
                        </div>
                        <div class="caption">
                          À :
                          <input
                            type="number"
                            [(ngModel)]="maxPrice"
                            (input)="filterAdsByPrice()"
                            class="form-control"
                            style="width: 90%; display: inline-block"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="custome-checkbox">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      name="checkbox"
                      id="exampleCheckbox211"
                      value=""
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12" class="col-xl-12 text-end d-none d-xl-block">
        <div class="shop-product-fillter">
          <div class="totall-product">
            <p>
              Nous avons trouvé
              <strong class="text-brand">{{ displayedAds.length }}</strong>
              annonces pour vous !
            </p>
          </div>
          <div class="sort-by-product-area">
            <div class="sort-by-cover mr-10">
              <div class="sort-by-product-wrap">
                <div class="sort-by">
                  <span><i class="fi-rs-apps"></i>Afficher :</span>
                </div>
                <div class="sort-by-dropdown-wrap">
                  <span
                    >{{ adsPerPage }} <i class="fi-rs-angle-small-down"></i
                  ></span>
                </div>
              </div>
              <div class="sort-by-dropdown">
                <ul>
                  <li>
                    <a
                      [class.active]="adsPerPage === 10"
                      (click)="changeAdsPerPage(10)"
                      >10</a
                    >
                  </li>
                  <li>
                    <a
                      [class.active]="adsPerPage === 20"
                      (click)="changeAdsPerPage(20)"
                      >20</a
                    >
                  </li>
                  <li>
                    <a
                      [class.active]="adsPerPage === 50"
                      (click)="changeAdsPerPage(50)"
                      >50</a
                    >
                  </li>
                  <li>
                    <a
                      [class.active]="adsPerPage === filteredAds.length"
                      (click)="changeAdsPerPage(filteredAds.length)"
                      >Tout</a
                    >
                  </li>
                </ul>
              </div>
            </div>
            <div class="sort-by-cover">
              <div class="sort-by-product-wrap">
                <div class="sort-by">
                  <span><i class="fi-rs-apps-sort"></i>Trier par :</span>
                </div>
                <div class="sort-by-dropdown-wrap">
                  <span
                    >{{ getSortOptionLabel(sortOption) }}
                    <i class="fi-rs-angle-small-down"></i
                  ></span>
                </div>
              </div>
              <div class="sort-by-dropdown">
                <ul>
                  <li>
                    <a
                      [class.active]="sortOption === 'featured'"
                      (click)="changeSortOption('featured')"
                      >Mis en avant</a
                    >
                  </li>
                  <li>
                    <a
                      [class.active]="sortOption === 'priceLowToHigh'"
                      (click)="changeSortOption('priceLowToHigh')"
                      >Prix : croissant</a
                    >
                  </li>
                  <li>
                    <a
                      [class.active]="sortOption === 'priceHighToLow'"
                      (click)="changeSortOption('priceHighToLow')"
                      >Prix : décroissant</a
                    >
                  </li>
                  <li>
                    <a
                      [class.active]="sortOption === 'releaseDate'"
                      (click)="changeSortOption('releaseDate')"
                      >Date de sortie</a
                    >
                  </li>
                </ul>
              </div>
            </div>

            <!--             <div class="sort-by-cover" *ngFor="let key of getFilterKeys()">
              <div class="sort-by-product-wrap">
                <div class="sort-by">
                  <span><i class="fi-rs-apps-sort"></i>{{ filters[key].label }} :</span>
                </div>
                <div class="sort-by-dropdown-wrap">
                  <span
                    >{{ getSortOptionLabel(sortOption) }}
                    <i class="fi-rs-angle-small-down"></i
                  ></span>
                </div>
              </div>
              <div class="sort-by-dropdown">
                <ul>
                  <li *ngFor="let condition of filters[key].conditions">
                    <a (click)="applyCondition(filters[key], condition)">
                      {{ condition }}
                    </a>
                  </li>
                </ul>
              </div>
            </div>


            <div *ngFor="let key of getFilterKeys()">
              <div class="filter-category">
                <div class="filter-label">{{ filters[key].label }}</div>
                <div class="filter-dropdown-wrap">
                  <span>
                    <i class="fi-rs-apps-sort"></i> Choisir une condition
                    <i class="fi-rs-angle-small-down"></i>
                  </span>
                  <div class="filter-dropdown">
                    <ul>
                      <li *ngFor="let condition of filters[key].conditions">
                        <a (click)="applyCondition(filters[key], condition)">
                          {{ condition }}
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div> -->
          </div>
        </div>

        <div class="row product-grid">
          <div
            *ngFor="let ad of displayedAds"
            class="col-lg-1-5 col-md-4 col-12 col-sm-6"
          >
            <div class="product-cart-wrap mb-30">
              <div class="product-img-action-wrap">
                <div class="product-img product-img-zoom" style="height: 240px">
                  <a [href]="'/ads/' + ad.id" style="height: 100%">
                    <img
                      class="default-img"
                      [src]="
                        ad.medias[0]?.url || 'assets/imgs/shop/default-img.jpg'
                      "
                      alt="{{ ad.title }}"
                    />
                    <img
                      class="hover-img"
                      [src]="ad.medias[1]?.url || ad.medias[0]?.url"
                      alt=""
                      style="height: 100%"
                    />
                  </a>
                </div>
                <div class="product-action-1">
                  <a
                    aria-label="Ajouter à la liste de souhaits"
                    class="action-btn"
                    (click)="addToFavorites(ad.id)"
                  >
                    <i class="fi-rs-heart"></i>
                  </a>
                </div>
                <div
                  class="product-badges product-badges-position product-badges-mrg"
                >
                  <span *ngIf="ad.urgent" class="hot">Urgent</span>
                </div>
              </div>
              <div class="product-content-wrap">
                <div class="product-category">
                  <a [href]="'/shop-grid-right/' + ad.category.id">{{
                    ad.category.name
                  }}</a>
                </div>
                <h2>
                  <a [href]="'/ads/' + ad.id">{{ ad.title }}</a>
                </h2>
                <div class="product-price">
                  <span>{{ ad.price }} DH</span>
                </div>
                <div>
                  <span class="font-small text-muted">{{
                    getRelativeTime(ad.created_at)
                  }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <ng-template #noAds>
          <p>Aucune annonce trouvée pour cette catégorie.</p>
        </ng-template>

        <div
          class="pagination-area mt-20 mb-20"
          *ngIf="displayedAds.length > 0"
        >
          <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-start">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a class="page-link" (click)="changePage(currentPage - 1)"
                  ><i class="fi-rs-arrow-small-left"></i
                ></a>
              </li>
              <li
                *ngFor="let page of getPagesArray()"
                class="page-item"
                [class.active]="page === currentPage"
              >
                <a class="page-link" (click)="changePage(page)">{{ page }}</a>
              </li>
              <li
                class="page-item"
                [class.disabled]="currentPage === totalPages"
              >
                <a class="page-link" (click)="changePage(currentPage + 1)"
                  ><i class="fi-rs-arrow-small-right"></i
                ></a>
              </li>
            </ul>
          </nav>
        </div>

        <!--         <section class="section-padding pb-5">
          <div class="section-title">
            <h3 class="">Deals Of The Day</h3>
            <a class="show-all" href="/shop-grid-right">
              All Deals
              <i class="fi-rs-angle-right"></i>
            </a>
          </div>
          <div class="row">
            <div class="col-xl-3 col-lg-4 col-md-6">
              <div class="product-cart-wrap style-2">
                <div class="product-img-action-wrap">
                  <div class="product-img">
                    <a href="/shop-product-right">
                      <img src="assets/imgs/banner/banner-5.png" alt="" />
                    </a>
                  </div>
                </div>
                <div class="product-content-wrap">
                  <div class="deals-countdown-wrap">
                    <div
                      class="deals-countdown"
                      data-countdown="2025/03/25 00:00:00"
                    ></div>
                  </div>
                  <div class="deals-content">
                    <h2>
                      <a href="/shop-product-right"
                        >Seeds of Change Organic Quinoa, Brown</a
                      >
                    </h2>
                    <div class="product-rate-cover">
                      <div class="product-rate d-inline-block">
                        <div class="product-rating" style="width: 90%"></div>
                      </div>
                      <span class="font-small ml-5 text-muted"> (4.0)</span>
                    </div>
                    <div>
                      <span class="font-small text-muted"
                        >By <a href="/vendor-details-1">NestFood</a></span
                      >
                    </div>
                    <div class="product-card-bottom">
                      <div class="product-price">
                        <span>$32.85</span>
                        <span class="old-price">$33.8</span>
                      </div>
                      <div class="add-cart">
                        <a class="add" href="/shop-cart"
                          ><i class="fi-rs-shopping-cart mr-5"></i>Add
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-4 col-md-6">
              <div class="product-cart-wrap style-2">
                <div class="product-img-action-wrap">
                  <div class="product-img">
                    <a href="/shop-product-right">
                      <img src="assets/imgs/banner/banner-6.png" alt="" />
                    </a>
                  </div>
                </div>
                <div class="product-content-wrap">
                  <div class="deals-countdown-wrap">
                    <div
                      class="deals-countdown"
                      data-countdown="2026/04/25 00:00:00"
                    ></div>
                  </div>
                  <div class="deals-content">
                    <h2>
                      <a href="/shop-product-right"
                        >Perdue Simply Smart Organics Gluten</a
                      >
                    </h2>
                    <div class="product-rate-cover">
                      <div class="product-rate d-inline-block">
                        <div class="product-rating" style="width: 90%"></div>
                      </div>
                      <span class="font-small ml-5 text-muted"> (4.0)</span>
                    </div>
                    <div>
                      <span class="font-small text-muted"
                        >By <a href="/vendor-details-1">Old El Paso</a></span
                      >
                    </div>
                    <div class="product-card-bottom">
                      <div class="product-price">
                        <span>$24.85</span>
                        <span class="old-price">$26.8</span>
                      </div>
                      <div class="add-cart">
                        <a class="add" href="/shop-cart"
                          ><i class="fi-rs-shopping-cart mr-5"></i>Add
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-4 col-md-6 d-none d-lg-block">
              <div class="product-cart-wrap style-2">
                <div class="product-img-action-wrap">
                  <div class="product-img">
                    <a href="/shop-product-right">
                      <img src="assets/imgs/banner/banner-7.png" alt="" />
                    </a>
                  </div>
                </div>
                <div class="product-content-wrap">
                  <div class="deals-countdown-wrap">
                    <div
                      class="deals-countdown"
                      data-countdown="2027/03/25 00:00:00"
                    ></div>
                  </div>
                  <div class="deals-content">
                    <h2>
                      <a href="/shop-product-right"
                        >Signature Wood-Fired Mushroom</a
                      >
                    </h2>
                    <div class="product-rate-cover">
                      <div class="product-rate d-inline-block">
                        <div class="product-rating" style="width: 80%"></div>
                      </div>
                      <span class="font-small ml-5 text-muted"> (3.0)</span>
                    </div>
                    <div>
                      <span class="font-small text-muted"
                        >By <a href="/vendor-details-1">Progresso</a></span
                      >
                    </div>
                    <div class="product-card-bottom">
                      <div class="product-price">
                        <span>$12.85</span>
                        <span class="old-price">$13.8</span>
                      </div>
                      <div class="add-cart">
                        <a class="add" href="/shop-cart"
                          ><i class="fi-rs-shopping-cart mr-5"></i>Add
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-4 col-md-6 d-none d-xl-block">
              <div class="product-cart-wrap style-2">
                <div class="product-img-action-wrap">
                  <div class="product-img">
                    <a href="/shop-product-right">
                      <img src="assets/imgs/banner/banner-8.png" alt="" />
                    </a>
                  </div>
                </div>
                <div class="product-content-wrap">
                  <div class="deals-countdown-wrap">
                    <div
                      class="deals-countdown"
                      data-countdown="2025/02/25 00:00:00"
                    ></div>
                  </div>
                  <div class="deals-content">
                    <h2>
                      <a href="/shop-product-right"
                        >Simply Lemonade with Raspberry Juice</a
                      >
                    </h2>
                    <div class="product-rate-cover">
                      <div class="product-rate d-inline-block">
                        <div class="product-rating" style="width: 80%"></div>
                      </div>
                      <span class="font-small ml-5 text-muted"> (3.0)</span>
                    </div>
                    <div>
                      <span class="font-small text-muted"
                        >By <a href="/vendor-details-1">Yoplait</a></span
                      >
                    </div>
                    <div class="product-card-bottom">
                      <div class="product-price">
                        <span>$15.85</span>
                        <span class="old-price">$16.8</span>
                      </div>
                      <div class="add-cart">
                        <a class="add" href="/shop-cart"
                          ><i class="fi-rs-shopping-cart mr-5"></i>Add
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section> -->
        <!--End Deals-->
      </div>
    </div>
  </div>
</main>

<app-footer></app-footer>

<app-preloader></app-preloader>
