<app-header></app-header>
<main class="main pages">
  <div class="page-header breadcrumb-wrap">
    <div class="container">
      <div class="breadcrumb">
        <a href="/" rel="nofollow" style="
        color: #3bb77e;
    "><i class="fi-rs-home mr-5" ></i>Accueil</a>
        <span></span> Compte <span></span> Mes messages
      </div>
    </div>
  </div>

  <div class="page-content pt-50 pb-150">
    <div class="container" >
      <!-- magnific-popup css -->
      <link
        href="../../assets_chat/libs/magnific-popup/magnific-popup.css"
        rel="stylesheet"
        type="text/css"
      />

      <!-- owl.carousel css -->
      <link
        rel="stylesheet"
        href="../../assets_chat/libs/owl.carousel/assets/owl.carousel.min.css"
      />

      <link
        rel="stylesheet"
        href="../../assets_chat/libs/owl.carousel/assets/owl.theme.default.min.css"
      />

      <!-- Bootstrap Css -->
      <link
        href="../../assets_chat/css/bootstrap.min.css"
        id="bootstrap-style"
        rel="stylesheet"
        type="text/css"
      />
      <!-- Icons Css -->
      <link
        href="../../assets_chat/css/icons.min.css"
        rel="stylesheet"
        type="text/css"
      />
      <!-- App Css-->
      <link
        href="../../assets_chat/css/app.min.css"
        id="app-style"
        rel="stylesheet"
        type="text/css"
      />

      <div class="layout-wrapper d-lg-flex">
        <!-- Start left sidebar-menu -->

        <!-- end left sidebar-menu -->

        <!-- start chat-leftsidebar -->
        <div class="chat-leftsidebar ms-lg-0" style="
        border-top-left-radius: 2rem;
        border-bottom-left-radius: 2rem;
    " *ngIf="!hidden">
          <div class="tab-content">
            <!-- Start chats tab-pane -->
            <div
              class="tab-pane fade show active"
              id="pills-chat"
              role="tabpanel"
              aria-labelledby="pills-chat-tab"
            >
              <!-- Start chats content -->
              <div>
                <div class="px-4 pt-4">
                  <h4 class="mb-4">Tous les messages</h4>
                  <div class="search-box chat-search-box">
                    <div class="input-group mb-3 rounded-3">
                      <span
                        class="input-group-text text-muted bg-light pe-1 ps-3"
                        id="basic-addon1"
                        style="padding-right: 1rem !important"
                      >
                        <i
                          class="fi fi-rr-search search-icon font-size-18"
                        ></i>
                      </span>
                      <input
                        type="text"
                        class="form-control bg-light"
                        placeholder="Recherche d'annonces"
                        aria-label="Recherche d'annonces"
                        aria-describedby="basic-addon1"
                        (input)="onSearch($event)"
                        style="background-color: white !important;border: 1px solid #dee2e6;"                      
                        />
                    </div>
                  </div>
                  <!-- Search Box-->
                </div>
                <!-- .p-4 -->

                <!-- Start chat-message-list -->
                <div class="">
                  <h5 class="mb-3 px-3 font-size-16">Recent</h5>
                  <div class="chat-message-list px-2" data-simplebar style="height: 80vh !important;">
                    <ul class="list-unstyled chat-list list chat-user-list">
                      <li
                        *ngFor="let conversation of filteredConversations"
                        (click)="onConversationClick(conversation)"
                        [ngClass]="{
                          active: conversation === activeConversation
                        }"
                      >
                        <a>
                          <div class="d-flex">
                            <div
                              class="chat-user-img online align-self-center me-3 ms-0"
                            >
                              <img
                                *ngIf="conversation.ad?.medias?.length > 0"
                                [src]="conversation.ad.medias[0]?.url"
                                class="rounded-3 avatar-xs"
                                alt=""
                              />
                              <span class="user-status"></span>
                            </div>
                            <div class="flex-grow-1 overflow-hidden">
                              <h5 class="text-truncate font-size-15 mb-1">
                                {{ conversation.ad.title }}
                              </h5>
                              <p class="text-truncate font-size-15 mb-1">
                                {{ conversation.ad.city }} -
                                {{ conversation.ad.price }}
                              </p>
                            </div>
                            <div class="font-size-11">
                              {{ this.formatDate(conversation.created_at) }}
                            </div>
                          </div>
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
                <!-- End chat-message-list -->
              </div>
              <!-- Start chats content -->
            </div>
          </div>
          <!-- end tab content -->
        </div>
        <!-- end chat-leftsidebar -->
        <div class="chat-leftsidebar me-lg-1 ms-lg-0"  style="
        border-top-left-radius: 2rem; border-top-right-radius: 2rem;
    " 
        *ngIf="hidden">
          <div
            class=" "
            style="border: 1px solid #e5e7eb;background-color: white !important;border-top-left-radius: 2rem;border-top-right-radius: 2rem;"          >
            <div class="d-lg-flex">
              <!-- start chat conversation section -->
              <div class="w-100 ">
                <div class="p-3 p-lg-4 border-bottom user-chat-topbar" style="
                border-radius: 2rem;
            ">
                      <div class="row align-items-center">
                        <div class="col-sm-4 col-8">
                          <div class="d-flex align-items-center">
                            <div class="d-block d-lg-none me-2 ms-0">
                              <a
                              (click)="goToConversation()"
                                class="user-chat-remove text-muted font-size-18 p-2"
                                ><i class="fi fi-rr-angle-circle-left"></i></a>
                            </div>
                            <div class="flex-grow-1 overflow-hidden">
                              <h5 class="font-size-16 mb-0 text-truncate">
                                <a href="#" class="text-reset user-profile-show"
                                  >À propos de cet acheteur</a
                                >
                              </h5>

                              <h6
                                class="font-size-12 mb-0 text-truncate"
                                style="margin-top: 0.5rem"
                              >
                                <a
                                  href="#"
                                  class="text-reset user-profile-show"
                                  style="
                                    color: rgba(33, 37, 41, 0.75) !important;
                                  "
                                  ><i
                                    class="fi fi-rr-user"
                                    style="margin-right: 0.6rem"
                                  ></i
                                  >Membre depuis {{ user_conversation }}</a
                                >
                              </h6>
                            </div>
                          </div>
                        </div>
                      </div>
                </div>
                <!-- end chat user head -->

                <!-- start chat conversation -->
                <div
                  class="chat-conversation p-3 p-lg-4"
                  data-simplebar="init"
                >
                  <ul class="list-unstyled mb-0">
                    <li
                      *ngFor="let message of messages"
                      [ngClass]="{ right: message.sender_id === senderId }"
                    >
                      <div class="conversation-list">
                        <div class="chat-avatar">
                          <img
                            *ngIf="message.sender.avatar_url"
                            [src]="message.sender.avatar_url"
                            alt="User Avatar"
                          />
                          <div
                            *ngIf="!message.sender.avatar_url"
                            class="avatar-placeholder"
                          >
                            {{
                              getInitials(
                                message.sender.first_name,
                                message.sender.last_name
                              )
                            }}
                          </div>
                        </div>
                        <div class="user-chat-content">
                          <div class="ctext-wrap">
                            <div
                              class="ctext-wrap-content"
                              style="max-width: 20rem"
                            >
                              <p class="mb-0">{{ message.content }}</p>
                              <p class="chat-time mb-0">
                                <i class="fi fi-rs-clock align-middle"></i>
                                <span
                                  class="align-middle"
                                  style="margin-left: 0.5rem"
                                >
                                  {{
                                    message.created_at | date : "shortTime"
                                  }}
                                </span>
                              </p>
                            </div>
                          </div>
                          <div class="conversation-name">
                            {{ message.sender.full_name }}
                          </div>
                        </div>
                      </div>
                    </li>
                  </ul>
                </div>
                <!-- end chat conversation end -->

                <!-- start chat input section -->
                <div class="chat-input-section p-3 p-lg-4 border-top mb-0">
                  <div class="row g-0">
                    <div class="col">
                      <input
                        type="text"
                        (keydown.enter)="sendMessage()"
                        [(ngModel)]="newMessage"
                        class="form-control form-control-lg bg-light border-light"
                        placeholder="Saisissez votre message ..."
                        style="
                          background-color: rgba(
                            230,
                            235,
                            245,
                            var(--bs-bg-opacity)
                          ) !important;
                        "
                      />
                    </div>
                    <div class="col-auto" style="margin-left: 1rem !important ">
                      <div class="chat-input-links ms-md-2 me-md-0">
                        <ul class="list-inline mb-0">
                          <li class="list-inline-item">
                            <button
                              type="button"
                              (click)="sendMessage()"
                              class="btn btn-primary font-size-16 btn-lg chat-send waves-effect waves-light"
                            >
                              <i class="fi fi-rs-paper-plane"></i>
                            </button>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- end chat input section -->
              </div>
              <!-- end chat conversation section -->
            </div>
            <!-- End User chat -->
          </div>

          <div
            class="chat-leftsidebar left into me-lg-0 ms-lg-0"
            style="
              border-top-right-radius: 2rem;
              border-bottom-right-radius: 2rem;
              min-width: 450px !important;
              max-width: 480px !important;
            "
          >
            <div class="tab-content">
              <!-- Start Profile tab-pane -->
              <div class="social-links">
                <div
                  *ngIf="ad_conversation?.ad?.user"
                  style="padding: 1rem; padding-top: 2rem"
                >
                  <a>
                    <div class="user-avatar">
                      <img
                        *ngIf="ad_conversation.ad.user.avatar_url"
                        [src]="ad_conversation.ad.user.avatar_url"
                        alt="User Avatar"
                        style="width: 35px"
                      />
                      <div
                        *ngIf="!ad_conversation.ad.user.avatar_url"
                        class="avatar-placeholder"
                        style="
                          width: 40px;
                          height: 40px; /* padding: 1.3rem; */
                          margin-left: 0.2rem;
                          margin-top: 0.2rem;
                        "
                      >
                        {{
                          getInitials(
                            ad_conversation.ad.user.first_name,
                            ad_conversation.ad.user.last_name
                          )
                        }}
                      </div>
                    </div>
                  </a>
                  <h5 class="section-title style-1 mb-30">
                    {{ ad_conversation.ad.user?.first_name }}
                    {{ ad_conversation.ad.user?.last_name }}
                  </h5>
                </div>
              </div>

              <div
                class="chat-message-list px-2"
                style="height: 80vh !important"
                data-simplebar
              >
                <ul class="list-unstyled chat-list chat-user-list">
                  <li *ngIf="ad_conversation?.ad">
                    <a>
                      <div class="d-flex">
                        <div
                          class="chat-user-img online align-self-center me-3 ms-0"
                        >
                          <img
                            *ngIf="ad_conversation.ad?.medias?.length > 0"
                            [src]="ad_conversation.ad?.medias[0]?.url"
                            class="rounded-3 avatar"
                            alt=""
                          />
                          <span class="user-status"></span>
                        </div>

                        <div class="flex-grow-1 overflow-hidden">
                          <h5 class="text-truncate font-size-15 mb-1">
                            {{ ad_conversation.ad.title }}
                          </h5>
                          <p class="text-truncate font-size-15 mb-1">
                            {{ ad_conversation.ad.price }}
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>

                  <li *ngIf="ad_conversation?.ad">
                    <a>
                      <div class="d-flex">
                        <div class="flex-grow-1 overflow-hidden">
                          <h5 class="text-truncate font-size-15 mb-1">
                            Description :
                          </h5>
                          <p>
                            {{
                              showMore ? longDescription : shortDescription
                            }}
                          </p>
                          <h5
                            class="text-truncate font-size-15 mb-1"
                            (click)="toggleShowMore()"
                            style="text-decoration: underline"
                          >
                            {{ showMore ? "Voir moins" : "Voir plus" }}
                          </h5>
                        </div>
                      </div>
                    </a>
                  </li>

                  <li *ngIf="ad_conversation?.ad">
                    <a>
                      <div class="d-flex">
                        <div class="flex-grow-1 overflow-hidden">
                          <h5 class="text-truncate font-size-15 mb-1">
                            Critère :
                          </h5>
                          <div class="" id="Additional-info">
                            <table class="font-md">
                              <tbody>
                                <tr
                                  class="stand-up"
                                  *ngFor="let field of transformedField"
                                >
                                  <th style="width: 50%">
                                    <i
                                      class="fi fi-rr-lightbulb-setting"
                                      style="margin-right: 1rem"
                                    ></i>
                                    {{ field.label }}
                                  </th>
                                  <td>
                                    <p class="pSetting">
                                      {{ field.setting }}
                                    </p>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </a>
                  </li>
                </ul>
              </div>

              <!-- End settings tab-pane -->
            </div>
            <!-- end tab content -->
          </div>

          <!-- end tab content -->
        </div>
        
        <!-- Start User chat -->
        <ng-template [ngIf]="ad_id">
          <div
            class="user-chat w-100 chat-leftsidebar "
            style="border: 1px solid #e5eaf4;background-color: white !important;max-width: 100% !important;"
          >
            <div class="d-lg-flex">
              <!-- start chat conversation section -->
              <div class="w-100 position-relative">
                <div class="p-3 p-lg-4 border-bottom user-chat-topbar">
                  <div class="row align-items-center">
                    <div class="col-sm-4 col-8">
                      <div class="d-flex align-items-center">
                        <div class="d-block d-lg-none me-2 ms-0">
                          <a
                            href="javascript: void(0);"
                            class="user-chat-remove text-muted font-size-16 p-2"
                            ><i class="ri-arrow-left-s-line"></i
                          ></a>
                        </div>
                        <div class="flex-grow-1 overflow-hidden">
                          <h5 class="font-size-16 mb-0 text-truncate">
                            <a href="#" class="text-reset user-profile-show"
                              >À propos de cet acheteur</a
                            >
                          </h5>

                          <h6
                            class="font-size-12 mb-0 text-truncate"
                            style="margin-top: 0.5rem"
                          >
                            <a
                              href="#"
                              class="text-reset user-profile-show"
                              style="
                                color: rgba(33, 37, 41, 0.75) !important;
                              "
                              ><i
                                class="fi fi-rr-user"
                                style="margin-right: 0.6rem"
                              ></i
                              >Membre depuis {{ user_conversation }}</a
                            >
                          </h6>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- end chat user head -->

                <!-- start chat conversation -->
                <div
                  class="chat-conversation p-3 p-lg-4"
                  data-simplebar="init"
                >
                  <ul class="list-unstyled mb-0">
                    <li
                      *ngFor="let message of messages"
                      [ngClass]="{ right: message.sender_id === senderId }"
                    >
                      <div class="conversation-list">
                        <div class="chat-avatar">
                          <img
                            *ngIf="message.sender.avatar_url"
                            [src]="message.sender.avatar_url"
                            alt="User Avatar"
                          />
                          <div
                            *ngIf="!message.sender.avatar_url"
                            class="avatar-placeholder"
                          >
                            {{
                              getInitials(
                                message.sender.first_name,
                                message.sender.last_name
                              )
                            }}
                          </div>
                        </div>
                        <div class="user-chat-content">
                          <div class="ctext-wrap">
                            <div
                              class="ctext-wrap-content"
                              style="max-width: 20rem"
                            >
                              <p class="mb-0">{{ message.content }}</p>
                              <p class="chat-time mb-0">
                                <i class="fi fi-rs-clock align-middle"></i>
                                <span
                                  class="align-middle"
                                  style="margin-left: 0.5rem"
                                >
                                  {{
                                    message.created_at | date : "shortTime"
                                  }}
                                </span>
                              </p>
                            </div>
                          </div>
                          <div class="conversation-name">
                            {{ message.sender.full_name }}
                          </div>
                        </div>
                      </div>
                    </li>
                  </ul>
                </div>
                <!-- end chat conversation end -->

                <!-- start chat input section -->
                <div class="chat-input-section p-3 p-lg-4 border-top mb-0" style="
                border: 1px solid #dee2e6;
            ">
                  <div class="row g-0">
                    <div class="col">
                      <input
                        type="text"
                        (keydown.enter)="sendMessage()"
                        [(ngModel)]="newMessage"
                        class="form-control form-control-lg bg-light border-light"
                        placeholder="Saisissez votre message ..."
                        style="
                          background-color: rgba(
                            230,
                            235,
                            245,
                            var(--bs-bg-opacity)
                          ) !important;
                        "
                      />
                    </div>
                    <div class="col-auto" >
                      <div class="chat-input-links ms-md-2 me-md-0">
                        <ul class="list-inline mb-0">
                          <li class="list-inline-item">
                            <button
                              type="button"
                              (click)="sendMessage()"
                              class="btn btn-primary font-size-16 btn-lg chat-send waves-effect waves-light"
                            >
                              <i class="fi fi-rs-paper-plane"></i>
                            </button>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- end chat input section -->
              </div>
              <!-- end chat conversation section -->
            </div>
            <!-- End User chat -->
          </div>

          <div
            class="chat-leftsidebar left into me-lg-0 ms-lg-0"
            style="
              border-top-right-radius: 2rem;
              border-bottom-right-radius: 2rem;
            "
          >
            <div class="tab-content">
              <!-- Start Profile tab-pane -->
              <div class="social-links">
                <div
                  *ngIf="ad_conversation?.ad?.user"
                  style="padding: 1rem; padding-top: 2rem"
                >
                  <a>
                    <div class="user-avatar">
                      <img
                        *ngIf="ad_conversation.ad.user.avatar_url"
                        [src]="ad_conversation.ad.user.avatar_url"
                        alt="User Avatar"
                        style="width: 35px"
                      />
                      <div
                        *ngIf="!ad_conversation.ad.user.avatar_url"
                        class="avatar-placeholder"
                        style="
                          width: 40px;
                          height: 40px; /* padding: 1.3rem; */
                          margin-left: 0.2rem;
                          margin-top: 0.2rem;
                        "
                      >
                        {{
                          getInitials(
                            ad_conversation.ad.user.first_name,
                            ad_conversation.ad.user.last_name
                          )
                        }}
                      </div>
                    </div>
                  </a>
                  <h5 class="section-title style-1 mb-30">
                    {{ ad_conversation.ad.user?.first_name }}
                    {{ ad_conversation.ad.user?.last_name }}
                  </h5>
                </div>
              </div>

              <div
                class="chat-message-list px-2"
                style="height: 80vh !important"
                data-simplebar
              >
                <ul class="list-unstyled chat-list chat-user-list">
                  <li *ngIf="ad_conversation?.ad">
                    <a>
                      <div class="d-flex">
                        <div
                          class="chat-user-img online align-self-center me-3 ms-0"
                        >
                          <img
                            *ngIf="ad_conversation.ad?.medias?.length > 0"
                            [src]="ad_conversation.ad?.medias[0]?.url"
                            class="rounded-3 avatar"
                            alt=""
                          />
                          <span class="user-status"></span>
                        </div>

                        <div class="flex-grow-1 overflow-hidden">
                          <h5 class="text-truncate font-size-15 mb-1">
                            {{ ad_conversation.ad.title }}
                          </h5>
                          <p class="text-truncate font-size-15 mb-1">
                            {{ ad_conversation.ad.price }}
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>

                  <li *ngIf="ad_conversation?.ad">
                    <a>
                      <div class="d-flex">
                        <div class="flex-grow-1 overflow-hidden">
                          <h5 class="text-truncate font-size-15 mb-1">
                            Description :
                          </h5>
                          <p>
                            {{
                              showMore ? longDescription : shortDescription
                            }}
                          </p>
                          <h5
                            class="text-truncate font-size-15 mb-1"
                            (click)="toggleShowMore()"
                            style="text-decoration: underline"
                          >
                            {{ showMore ? "Voir moins" : "Voir plus" }}
                          </h5>
                        </div>
                      </div>
                    </a>
                  </li>

                  <li *ngIf="ad_conversation?.ad">
                    <a>
                      <div class="d-flex">
                        <div class="flex-grow-1 overflow-hidden">
                          <h5 class="text-truncate font-size-15 mb-1">
                            Critère :
                          </h5>
                          <div class="" id="Additional-info">
                            <table class="font-md">
                              <tbody>
                                <tr
                                  class="stand-up"
                                  *ngFor="let field of transformedField"
                                >
                                  <th style="width: 50%">
                                    <i
                                      class="fi fi-rr-lightbulb-setting"
                                      style="margin-right: 1rem"
                                    ></i>
                                    {{ field.label }}
                                  </th>
                                  <td>
                                    <p class="pSetting">
                                      {{ field.setting }}
                                    </p>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </a>
                  </li>
                </ul>
              </div>

              <!-- End settings tab-pane -->
            </div>
            <!-- end tab content -->
          </div>
        </ng-template>

        <ng-template [ngIf]="!ad_id && !isMobileView">
          <div
            class="chat-welcome-section"
            style="
              width: 100%;

              background-color: #f7f7ff;
              border-top-right-radius: 2rem;
              border-bottom-right-radius: 2rem;
            "
          >
            <div class="row w-100 justify-content-center">
              <div class="col-xxl-5 col-md-7">
                <div class="p-4 text-center" style="margin-top: 12rem">
                  <div class="avatar-xl mx-auto mb-4">
                    <div class="avatar-title bg-secondary rounded-circle">
                      <svg
                        data-v-5e8ea5c2=""
                        xmlns="http://www.w3.org/2000/svg"
                        width="70px"
                        height="65px"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="feather feather-message-square"
                      >
                        <path
                          data-v-5e8ea5c2=""
                          d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
                        ></path>
                      </svg>
                    </div>
                  </div>
                  <h4
                    class="d-inline px-3 py-2 rounded-pill bg-secondary text-white fs-4"
                  >
                    Commencer la conversation
                  </h4>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
        <!-- end  layout wrapper -->
      </div>
    </div>
  </div>
</main>

<app-footer></app-footer>
<app-preloader></app-preloader>
